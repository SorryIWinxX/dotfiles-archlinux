"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[471],{8522:(e,t,o)=>{o.r(t),o.d(t,{default:()=>ze});var r=o(77422),i=o.n(r),s=o(77094),a=o.n(s),n=(o(33948),o(96486)),h=o.n(n),d=o(67294),l=o.n(d),c=o(83355),u=o(40902),p=o(66897),g=o(17215),m=o(41432),v=o(8848),f=o(39068),b=o(55061),y=o(98459),S=o(89101),A=o(58129),O=o(21202),_=o(77420),T=o(6287),k=o(13493),w=o(70279),J=o(33709),M=o(57883),B=o(84683),D=o(75246),I=o(29369),C=o(19889),N=o(94044),R=o(99108),P=o(70203),V=o(97880),Z=o(82990),F=o(63143),L=o(5366),U=o(50906),x=o(17659),E=o(9953),q=o(4083),G=o(38363),K=o(93561),W=o(14976),z=o(52821),H=o(17731),j=o(33929),$=o(86785),Y=o(67669),Q=o(80270),X=o(72500),ee=o(86777),te=o(61794),oe=o(20431),re=o(20454),ie=o(62820),se=o(4761),ae=o(97464),ne=o.n(ae),he=o(53397),de=o(51118),le=o(43250),ce=o(16402),ue=o(12318),pe=o(14947),ge=o(80527),me=o(67706),ve=o(32469),fe=o(8934),be=o(37235),ye=o(49481),Se=o(52738);class Ae extends c.Z{constructor(){super(...arguments),i()(this,"storeTypes",{hovered:ue.default.of(!1)}),i()(this,"handleMouseMove",(()=>{this.stores.hovered.set(!0)})),i()(this,"handleMouseLeave",(()=>{this.stores.hovered.set(!1)})),i()(this,"handleArchive",(()=>{const{notification:e,rootStore:t}=this.props;e&&K.createAndCommit({userAction:"ActivitySection.handleArchive",environment:this.environment,perform:o=>{x.aZ({notification:e,rootStore:t,transaction:o})}})})),i()(this,"handleOpenSnapshot",(()=>{if(this.props.navigableBlockId){const e=Q.Z.createChildStore(this.props.rootStore,{table:O.iU,id:this.props.navigableBlockId});de.jN({environment:this.environment,blockStore:e,openSnapshotNearTimestamp:this.props.timestamp.toString(),from:"activity"})}}))}renderComponent(){const{children:e}=this.props;return a()("div",{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave},void 0,a()("div",{style:{...Ae.wrapStyle,paddingBottom:e?12:8,paddingLeft:this.environment.device.isMobile?this.environment.WindowSizeStore.state.paddingLeftCSS:0,paddingRight:this.environment.device.isMobile?this.environment.WindowSizeStore.state.paddingRightCSS:0}},void 0,a()("div",{style:this.getHeaderAndAvatarStyle()},void 0,a()("div",{className:le.Fo},void 0,this.props.icon),this.renderHeader(),this.renderSnapshotButton(),this.renderArchiveAction(),this.renderPrivate()),e&&this.renderChildren()),this.renderDivider())}renderDivider(){const{isLast:e}=this.props;if(!e)return a()("div",{style:this.getBorderBottomStyle()})}renderHeader(){const{timestamp:e,header:t}=this.props,o=(0,ce.IS)(e),r=(0,ce.uy)(e);return a()("div",{style:Ae.headerStyle},void 0,a()("div",{className:le.NF},void 0,t),a()("div",{style:{display:"flex",marginTop:4,marginBottom:this.props.children?8:4}},void 0,a()("div",{style:this.getTimeStyle(),className:le.CZ},void 0,a()(me.Z,{text:o,tooltipText:r,icon:he.Z.calendar})),this.props.navigableBlockId&&this.props.rootStore&&a()(fe.Z,{isLink:!0,innerStyle:this.getPathStyle(),store:Q.Z.createChildStore(this.props.rootStore,{table:O.iU,id:this.props.navigableBlockId}),left:a()("div",{style:this.getSeparatorDotStyle()},void 0,"Â·")})))}renderSnapshotButton(){if(this.props.showSnapshotButton&&!(this.props.timestamp<new Date("2018-10-26").getTime()))return this.props.navigableBlockId?a()(be.Z,{renderTooltip:()=>a()(L.FormattedMessage,{defaultMessage:"View version for this update",id:"activitySection.viewVersionForUpdate.tooltip"}),render:e=>l().createElement(ge.Z,ne()({onClick:this.handleOpenSnapshot,icon:he.Z.versionHistoryThick},e))}):void 0}renderArchiveAction(){const{notification:e}=this.props,{device:t}=this.environment,{currentTab:o}=se.Z.state;if("mentions"===o&&e&&!e.visited)return a()(be.Z,{renderTooltip:()=>a()(L.FormattedMessage,{defaultMessage:"Archive this notification",id:"activitySection.archiveAction.tooltip"}),render:e=>l().createElement("div",ne()({style:{...Ae.statusLabelContainerStyle,position:"relative",marginLeft:this.environment.device.isMobile?23:8}},e),!this.isSeen()&&a()("div",{style:{...Ae.statusDotStyle,opacity:this.stores.hovered.get()?0:1,right:this.environment.device.isMobile?28:2.5,top:this.environment.device.isMobile?7.5:5.5}}),a()(pe.Z,{onClick:this.handleArchive,style:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:this.theme.buttonHoveredBackground,width:t.isMobile?24:20,height:t.isMobile?24:20,opacity:this.environment.device.isMobile||this.stores.hovered.get()?1:0},hoveredStyle:{background:this.theme.buttonPressedBackground}},void 0,he.Z.closeSmall({width:t.isMobile?18:14,fill:this.theme.mediumTextColor})))})}renderPrivate(){if(this.props.isPrivate&&!this.props.notification)return a()(ve.Z,{style:{marginTop:1,marginBottom:4,marginLeft:8}})}renderChildren(){return a()("div",{className:le.nU},void 0,this.props.children)}isSeen(){const{notification:e}=this.props;return!e||e.read}getHeaderAndAvatarStyle(){return{display:"flex",paddingLeft:16,paddingRight:16}}getBorderBottomStyle(){return{borderBottom:"1px solid ".concat(this.theme.regularDividerColor)}}getPathStyle(){return{fontSize:12,color:this.theme.lightTextColor}}getTimeStyle(){return{fontSize:12,color:this.theme.lightTextColor,whiteSpace:"nowrap"}}getSeparatorDotStyle(){return{fontSize:12,color:this.theme.lightTextColor,marginLeft:4,marginRight:4}}}i()(Ae,"wrapStyle",{paddingTop:12}),i()(Ae,"headerStyle",{fontSize:14,lineHeight:1.4,flexGrow:1,minWidth:0}),i()(Ae,"statusLabelContainerStyle",{display:"flex",alignItems:"flex-start",marginTop:1,marginBottom:4}),i()(Ae,"statusDotStyle",{height:8,width:8,flexShrink:0,marginRight:4,background:v.ZP.blue,borderRadius:"100%",position:"absolute",pointerEvents:"none"});const Oe={fontWeight:Z.Z.fontWeight.semibold},_e={marginTop:2,marginRight:8,flexShrink:0};function Te(e){const{authors:t}=e,o=t[0];return o&&(0,p.z8)(o)?a()(ye.Z,{botValue:o.value,style:_e,size:28}):a()(Se.Z,{userValue:o&&o.value,style:_e,size:28,avatarShouldShowShadow:!0})}function ke(){return a()("div",{style:{display:"flex",backgroundColor:v.ZP.red,height:28,width:28,borderRadius:"100%",..._e}},void 0,he.Z.alarmClock({height:16,width:16,fill:v.ZP.white,marginLeft:6,marginTop:5}))}function we(e){const t=e.map((e=>(0,p.$4)(j.default.getIntl(),e)));if(1===t.length)return a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"<b>{author}</b>",id:"activitySection.authorPhrase.forOneAuthor.label",values:{author:t[0],b:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return a()("span",{style:Oe},void 0,t)}}}));if(2===t.length)return a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"<b>{firstAuthor}</b> and <b>{secondAuthor}</b>",id:"activitySection.authorPhrase.forTwoAuthors.label",values:{firstAuthor:t[0],secondAuthor:t[1],b:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return a()("span",{style:Oe},void 0,t)}}}));if(t.length>2){const e=a()(L.FormattedMessage,{defaultMessage:"{numberOfOtherAuthors, plural, one {<b>{firstAuthor}</b>, <b>{secondAuthor}</b>, and {numberOfOtherAuthors} other} other {<b>{firstAuthor}</b>, <b>{secondAuthor}</b>, and {numberOfOtherAuthors} others}}",id:"activitySection.authorPhrase.forMoreThanTwoAuthors.label",values:{numberOfOtherAuthors:t.length-2,firstAuthor:t[0],secondAuthor:t[1],b:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return a()("span",{style:Oe},void 0,t)}}});return a()("span",{},void 0,e)}return a()("span",{style:Oe},void 0,a()(L.FormattedMessage,{defaultMessage:"Nobody",id:"activitySection.authorPhrase.forNoAuthors.label"}))}const Je=Ae;var Me=o(45669),Be=o(79931),De=o(27006),Ie=o(76464),Ce=o(17256),Ne=o(1643),Re=o(78291),Pe=o(7567),Ve=o(33058),Ze=o(46951);class Fe extends c.Z{constructor(){super(...arguments),i()(this,"storeTypes",{role:ue.default.of(void 0)}),i()(this,"handleGrantAccess",(async()=>{const{targetBlockStore:e,accessRequestStore:t}=this.props,o=this.getInviteTargetWithNewPermissionItem();if(!("permissionItem"in o))return;const r=this.environment.currentUser.id;if(!r)return;if("type"in o){let t;if("existingUser"===o.type){t=(await Ie.n_({environment:this.environment,store:e,inviteTargets:[o],inviteRole:o.permissionItem.role,isOnboarding:!1,invite:{inviteOrigin:"page_request_access"}})).success}else if("bot"===o.type){t=(await Ie.n_({environment:this.environment,store:e,inviteTargets:[o],inviteRole:void 0,isOnboarding:!1,invite:{inviteOrigin:"page_request_access"}})).success}else(0,V.t1)(o);if(!t)return}K.createAndCommit({userAction:"GrantAccessActivityAction.handleGrantAccess",environment:this.environment,perform:i=>{"type"in o||Ie.ep({environment:this.environment,transaction:i,store:e,permissionItems:[o.permissionItem]}),E.sW({store:t,transaction:i,data:{granted_time:Date.now(),granted_by_table:C.KJ,granted_by_id:r,resolved_time:Date.now(),resolved_by_table:C.KJ,resolved_by_id:r,status:"approved"}})}});const i=t.getValue(),s=i&&i.created_time&&i.granted_time?i.granted_time-i.created_time:void 0;U.nCD(this.environment,{requestId:i&&i.id,timeElapsedSinceRequest:s})})),i()(this,"handleRoleChange",(e=>this.stores.role.setState(e))),i()(this,"handleArchive",(()=>{const{notification:e}=this.props;e&&(K.createAndCommit({userAction:"GrantAccessActivityAction.handleArchive",environment:this.environment,perform:t=>{(0,x.aZ)({notification:e,rootStore:this.props.accessRequestStore,transaction:t})}}),U.cOL(this.environment))}))}renderComponent(){const e=this.props.accessRequestStore.getValue();if(!e)return;if((0,A.Kc)(e))return this.renderGrantedAccessRequest(e);if(!this.canGrantAccess())return;const t=this.getCurrentPermissionItem();if(t){const o=this.renderActor(e.for_actor_table,e.for_actor_id),r=t.role===this.getRole();return l().createElement(l().Fragment,null,a()(Ze.Z,{isSecondaryColor:!0,style:{marginBottom:6}},void 0,a()(L.FormattedMessage,{defaultMessage:"{requestingUser} already has access.",id:"grantAccessActivityAction.alreadyHasAccess.label",description:"Shown if the user who requested access already has access",values:{requestingUser:o}})),a()(Pe.Z,{upgradeButtonName:"user_permission_item",role:this.getRole(),table:O.iU,blockType:this.props.targetBlockStore.getType(),type:e.for_actor_table===C.KJ?"user_permission":"bot_permission",onChange:this.handleRoleChange,isInvite:!0,buttonStyle:this.getButtonStyle(!0)}),a()(Ve.Z,{onClick:this.handleGrantAccess,style:this.getButtonStyle(r)},void 0,a()(L.FormattedMessage,{defaultMessage:"Change",id:"grantAccessActivityAction.changePermissionButton.label"})),this.renderArchiveButton())}return l().createElement(l().Fragment,null,a()(Pe.Z,{upgradeButtonName:"user_permission_item",role:this.getRole(),table:O.iU,blockType:this.props.targetBlockStore.getType(),type:e.for_actor_table===C.KJ?"user_permission":"bot_permission",onChange:this.handleRoleChange,isInvite:!0,buttonStyle:this.getButtonStyle(!1)}),a()(Ve.Z,{onClick:this.handleGrantAccess,style:this.getButtonStyle(!1)},void 0,a()(L.FormattedMessage,{defaultMessage:"Grant access",id:"grantAccessActivityAction.grantAccessButton.label"})),this.renderArchiveButton())}renderGrantedAccessRequest(e){const t=this.renderActor(e.granted_by_table,e.granted_by_id),o=(0,Ce.Z)(Math.min(e.granted_time,Date.now())).calendar();return l().createElement(l().Fragment,null,a()(Ze.Z,{isSecondaryColor:!0},void 0,a()(L.FormattedMessage,{defaultMessage:"Approved by {grantedBy}",id:"grantAccessActivityAction.accessGranted.title",values:{grantedBy:t,time:o}})),a()(Ze.Z,{isSmall:!0,isSecondaryColor:!0},void 0,o))}renderArchiveButton(){const{notification:e}=this.props;if(e&&!e.visited)return a()(Ve.Z,{onClick:this.handleArchive,style:{height:26,paddingLeft:8,paddingRight:8}},void 0,a()(L.FormattedMessage,{defaultMessage:"Ignore",id:"grantAccessActivityAction.ignoreButton.label"}))}getRole(){const e=this.getCurrentPermissionItem(),t=e&&e.role;return this.stores.role.state||t||this.props.initialRole}getNewPermissionItem(){const e=this.props.accessRequestStore.getValue();if(e)return e.for_actor_table===C.KJ?{type:"user_permission",user_id:e.for_actor_id,role:this.getRole()}:{type:"bot_permission",bot_id:e.for_actor_id,role:this.getRole()}}getInviteTargetWithNewPermissionItem(){const e=this.getNewPermissionItem();if(!e)return{};if(this.getCurrentPermissionItem())return{permissionItem:e};const{data:t}=Re.default.state;if("user_permission"===e.type){const o=this.rootStore.getRecordValue({table:C.KJ,id:e.user_id}),r=t?Ne.uF(t):[],i=r&&r.some((t=>t.userId===e.user_id));return o&&!i?{type:"existingUser",value:o,permissionItem:e}:{permissionItem:e}}if("bot_permission"===e.type){const o=this.rootStore.getRecordValue({table:_.cZ,id:e.bot_id}),r=(t?Ne.NM(t):[]).some((t=>t.botId===e.bot_id));return o&&!r?{type:"bot",value:o,permissionItem:e}:{permissionItem:e}}(0,V.t1)(e)}getCurrentPermissionItem(){const e=this.props.accessRequestStore.getValue();if(!e)return;const t=this.props.targetBlockStore.getPermissionItems();for(const o of t){if(e.for_actor_table===C.KJ&&(0,De.jg)(o)&&o.user_id===e.for_actor_id)return o;if(e.for_actor_table===_.cZ&&(0,De.FB)(o)&&o.bot_id===e.for_actor_id)return o}}canGrantAccess(){return this.props.targetBlockStore.canAdmin()}renderActor(e,t){return we(h().compact([this.getActor(e,t)]))}getActor(e,t){if(e===C.KJ){const o=this.rootStore.getRecordValue({table:e,id:t});if(o)return(0,p.dp)(o)}if(e===_.cZ){const o=this.rootStore.getRecordValue({table:e,id:t});if(o)return(0,p.D$)(o)}}get rootStore(){return this.props.accessRequestStore}getButtonStyle(e){const t={height:26,paddingLeft:8,paddingRight:8,boxShadow:this.theme.plainButtonBoxShadow,fontSize:12,marginRight:10};return e?t:{...t,color:this.theme.regularTextColor,fontWeight:500}}}const Le=Fe;var Ue=o(28240),xe=o(40039),Ee=o(79029);class qe extends c.Z{constructor(){super(...arguments),i()(this,"storeTypes",{open:ue.default.of(!1)}),i()(this,"handleOpen",(()=>{this.stores.open.set(!0)}))}renderComponent(){return this.stores.open.get()||this.props.items.length<=this.props.visible?a()("div",{},void 0,this.props.items):a()("div",{},void 0,this.props.items.slice(0,this.props.visible),a()(pe.Z,{onClick:this.handleOpen,style:this.getStyle()},void 0,a()(L.FormattedMessage,{defaultMessage:"View {moreCount} more",id:"activity.viewMoreButton.label",values:{moreCount:this.props.items.length-this.props.visible}})))}getStyle(){return{display:"flex",alignItems:"center",height:28,fontSize:12,color:this.theme.lightTextColor,padding:0,paddingLeft:52,paddingRight:16}}}const Ge=qe,Ke=a()("div",{style:{width:5,display:"inline-block"}});class We extends c.Z{constructor(){super(...arguments),i()(this,"renderBlockEdit",((e,t,o)=>{let r=this.getRecordValue({table:O.iU,id:e.block_id});r&&r.type===m.ZP.tableRow&&(r=this.getRecordValue({table:O.iU,id:r.parent_id}));const i=r?(0,g.Om)({table:"block",value:r,getRecordValue:this.getRecordValue}):S._j.root;return"block-deleted"===e.type?e.block_data.block_value.type===m.ZP.page?a()(Ue.Z,{href:i,onClick:()=>this.track("block_edit"),innerStyle:We.editButtonStyle},t,a()(Be.Z,{edit:e,rootStore:this.props.rootStore})):a()("div",{style:We.editButtonStyle},t,a()(Be.Z,{edit:e,rootStore:this.props.rootStore})):a()(Ue.Z,{href:i,onClick:()=>this.track("block_edit"),innerStyle:We.editButtonStyle},t,a()(Be.Z,{edit:e,rootStore:this.props.rootStore}))})),i()(this,"handleUnfollow",(()=>this.setFollowing(!1))),i()(this,"handleFollow",(()=>this.setFollowing(!0))),i()(this,"handleUnarchive",(()=>{const{notification:e,rootStore:t}=this.props;e&&K.createAndCommit({userAction:"Activity.handleUnarchive",environment:this.environment,perform:o=>{x.E1({notificationId:e.id,visited:!1,rootStore:t,transaction:o})}})})),i()(this,"getUserValue",(e=>re.Z.createChildStore(this.props.rootStore,{table:C.KJ,id:e}).getValue())),i()(this,"getBotValue",(e=>(0,ee.Kv)(this.props.rootStore,{table:_.cZ,id:e}).getValue())),i()(this,"getAuthorActor",(e=>{if(e.table===C.KJ){const t=this.getUserValue(e.id);if(t)return(0,p.dp)(t)}else{const t=this.getBotValue(e.id);if(t)return(0,p.D$)(t)}})),i()(this,"getSpaceValue",(e=>te.Z.createChildStore(this.props.rootStore,{table:D.bx,id:e}).getValue())),i()(this,"getTeamValue",(e=>oe.Z.createChildStore(this.props.rootStore,{table:I.e0,id:e}).getValue())),i()(this,"getDiscussionContextAndId",(()=>{const{activity:e}=this.props;if("commented"!==e.type)return;const t=this.getRecordValue({table:J.qF,id:e.discussion_id,spaceId:e.space_id});if(!t)return;if(!t.context)return;const o=(0,P.VP)(t.context,(e=>!(0,P.xw)(e)||(0,P.h1)(e)===t.id));return{id:t.id,context:o}})),i()(this,"getDiscussionContext",(()=>{const e=this.getDiscussionContextAndId();if(e)return e.context}))}willMountOrUpdate(){this.warmCommentData(),this.environment.KatexStore.loadIfNeeded(this.getDiscussionContext)}warmCommentData(){if("commented"===this.props.activity.type){const e=(0,ee.Kv)(this.props.rootStore,{table:J.qF,id:this.props.activity.discussion_id,spaceId:this.props.activity.space_id}).getValue();if(e){const t=e.comments||[];for(const e of t){const t=(0,ee.Kv)(this.props.rootStore,{table:w.x_,id:e,spaceId:this.props.activity.space_id}).getValue();if(t&&t.created_by_table&&t.created_by_id){(0,ee.Kv)(this.props.rootStore,{table:t.created_by_table,id:t.created_by_id}).getValue()}}}}}renderComponent(){const{activity:e}=this.props;switch(e.type){case"block-edited":return this.renderBlockEditActivity(e);case"collection-row-created":case"collection-row-deleted":return this.renderCollectionRowActivity(e);case"top-level-block-created":case"top-level-block-deleted":return this.renderTopLevelBlockActivity(e);case"permissions-edited":return this.renderPermissionsActivity(e);case"permission-group-edited":return this.renderPermissionGroupActivity(e);case"user-mentioned":return this.renderMentionActivity(e);case"commented":return this.renderCommentActivity(e);case"user-invited":return this.renderUserInvitedActivity(e);case"collection-edited":return this.renderCollectionEdited(e);case"collection-view-edited":return this.renderCollectionViewEdited(e);case"collection-property-edited":return this.renderCollectionPropertyEdited(e);case"reminder":return this.renderReminderActivity(e);case"page-locked":case"page-unlocked":return this.renderPageLockActivity(e);case"email-edited":return this.renderEmailEdited(e);case"access-requested":return this.renderAccessRequested(e);case"page-deleted":case"page-restored":case"page-permanently-deleted":return this.renderPageDeleteOrRestoreActivity(e);case"team-membership-edited":return this.renderTeamMembershipEditedActivity(e);case"private-content-transferred":return this.renderPrivateContentTransferredActivity(e);default:(0,V.t1)(e)}}renderBlockEditActivity(e){if(!e.edits)return;const t=(0,R.hI)(e.edits).filter((e=>{const{block_value:t}="block-changed"===e.type?e.block_data.after:e.block_data;return t.parent_table!==w.x_}));if(0===t.length)return;const o=this.getBlockValue(t[0].navigable_block_id);if(!o)return;const r=this.getAuthors(t),i=we(r),s=this.renderTitle("block",o);return a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited {pageTitle}} other {{authorOrAuthors} edited {pageTitle}}}",id:"activity.blockEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)",values:{numberOfAuthors:r.length,authorOrAuthors:i,pageTitle:s}})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(o.id,"block"),rootStore:this.props.rootStore,navigableBlockId:o.id,notification:this.props.notification,icon:a()(Te,{authors:r}),showSnapshotButton:this.props.isTopbarUpdatesMenu},void 0,a()(Ge,{visible:5,items:t.map(this.renderBlockEdit)}),this.renderNotificationActions())}renderCollectionRowActivity(e){if(!e.edits)return;const t=e.edits[0],o=this.getBlockValue(e.collection_row_id);if(!o)return;if(!o.properties)return;const r=this.getAuthors(e.edits),i=we(r),s=this.renderTitle("block",o),n="collection-row-created"===t.type?a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created {pageTitle}} other {{authorOrAuthors} created {pageTitle}}}",values:{numberOfAuthors:r.length,authorOrAuthors:i,pageTitle:s},id:"activity.collectionRowCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted {pageTitle}} other {{authorOrAuthors} deleted {pageTitle}}}",values:{numberOfAuthors:r.length,authorOrAuthors:i,pageTitle:s},id:"activity.collectionRowDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,n),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(o.id,"block"),rootStore:this.props.rootStore,navigableBlockId:o.id,notification:this.props.notification,icon:a()(Te,{authors:r}),showSnapshotButton:this.props.isTopbarUpdatesMenu},void 0,this.renderNotificationActions())}renderTopLevelBlockActivity(e){if(!e.edits)return;const t=e.edits[0],o=this.getBlockStore(e.top_level_block_id),r=o.getValue();if(!r)return;const i=o.hasSpacePermission(),s=this.getAuthors(e.edits),n=we(s),h=this.renderTitle("block",r);let d;return d=i?"top-level-block-created"===t.type?a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created workspace page {pageTitle}} other {{authorOrAuthors} created workspace page {pageTitle}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,pageTitle:h},id:"activity.topLevelBlockWorkspaceCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted workspace page {pageTitle}} other {{authorOrAuthors} deleted workspace page {pageTitle}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,pageTitle:h},id:"activity.topLevelBlockWorkspaceDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"top-level-block-created"===t.type?a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created private page {pageTitle}} other {{authorOrAuthors} created private page {pageTitle}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,pageTitle:h},id:"activity.topLevelBlockPrivateCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted private page {pageTitle}} other {{authorOrAuthors} deleted private page {pageTitle}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,pageTitle:h},id:"activity.topLevelBlockPrivateDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,d),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(r.id,"block"),rootStore:this.props.rootStore,notification:this.props.notification,icon:a()(Te,{authors:s}),showSnapshotButton:!1})}renderPermissionsActivity(e){if(!e.edits)return;const t=(0,R.hI)(e.edits);if(0===t.length)return;let o,r;const i=t[0];if(i.navigable_block_id){const e=this.getBlockValue(i.navigable_block_id);if(!e)return;r=this.renderTitle("block",e),o=this.getIsRecordPrivateToUser(e.id,"block")}else{const e=this.getSpaceValue(i.space_id);if(!e)return;r=this.renderTitle("space",e),o=this.getIsRecordPrivateToUser(i.space_id,"space")}const{autojoinEdits:s,inheritanceEdits:n,otherEdits:h}=u.md(e.edits),d=[];if(s.forEach(((e,t)=>{const i=this.getAuthors([e]),s=we(i);d.push(a()(Je,{timestamp:e.timestamp,header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} joined {pageOrSpaceName}} other {{authorOrAuthors} joined {pageOrSpaceName}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,pageOrSpaceName:r},id:"activity.permissionsActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:o,rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:a()(Te,{authors:i}),showSnapshotButton:!1},"autojoin-".concat(t)))})),n.forEach(((t,i)=>{const s=this.getAuthors([t]),n=we(s);let h;"permission-restriction-created"===t.type?h=a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} restricted access for {pageOrSpaceName}} other {{authorOrAuthors} restricted access for {pageOrSpaceName}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,pageOrSpaceName:r},id:"activity.restrictPermissionsForActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"permission-restriction-deleted"===t.type&&(h=a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} restored inherited access for {pageOrSpaceName}} other {{authorOrAuthors} restored inherited access for {pageOrSpaceName}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,pageOrSpaceName:r},id:"activity.restorePermissionsForActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),d.push(a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,h),isLast:this.props.isLast,isPrivate:o,rootStore:this.props.rootStore,navigableBlockId:t.navigable_block_id,notification:this.props.notification,icon:a()(Te,{authors:s}),showSnapshotButton:!1},"inheritance-".concat(i),a()("div",{style:We.editButtonStyle},void 0,a()(Be.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions()))})),h.length>0){const t=this.getAuthors(h),s=we(t);d.push(a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} updated permission for {pageOrSpaceName}} other {{authorOrAuthors} updated permission for {pageOrSpaceName}}}",values:{numberOfAuthors:t.length,authorOrAuthors:s,pageOrSpaceName:r},id:"activity.updatedPermissionsForActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:o,rootStore:this.props.rootStore,navigableBlockId:i.navigable_block_id,notification:this.props.notification,icon:a()(Te,{authors:t}),showSnapshotButton:!1},"others",h.map(((e,t,o)=>a()("div",{style:We.editButtonStyle},t,a()(Be.Z,{edit:e,rootStore:this.props.rootStore},t)))),this.renderNotificationActions()))}return d}renderPermissionGroupActivity(e){if(!e.edits)return;const t=(0,R.hI)(e.edits)[0];if(!t)return;const o=this.getSpaceValue(t.space_id);if(!o)return;const r=(0,g.Om)({table:"space",value:o,getRecordValue:this.getRecordValue}),i=this.renderPermissionGroupTitle((0,b.c_)({activity:e,getRecordValue:this.getRecordValue}),e.space_id),s=this.getAuthors(e.edits);return a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,this.renderPermissionGroupEditedHeader({activity:e,authors:s,groupName:i})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.space_id,"space"),rootStore:this.props.rootStore,notification:this.props.notification,icon:a()(Te,{authors:s}),showSnapshotButton:!1},void 0,a()(Ue.Z,{href:r,onClick:()=>this.track("group_edit"),innerStyle:We.editButtonStyle},void 0,a()(Be.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions())}renderMentionActivity(e){if(!e.edits)return;const t=e.edits[0],o=this.getBlockValue(t.navigable_block_id);if(!o)return;const r=this.getBlockValue(e.mentioned_block_id);if(!r)return;const i=(0,g.Om)({table:"block",value:r,getRecordValue:this.getRecordValue}),s=this.getAuthors(e.edits),n=we(s);return a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} mentioned you in {pageName}} other {{authorOrAuthors} mentioned you in {pageName}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,pageName:this.renderTitle("block",o)},id:"activity.mentionActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(o.id,"block"),rootStore:this.props.rootStore,navigableBlockId:o.id,notification:this.props.notification,icon:a()(Te,{authors:s}),showSnapshotButton:!1},void 0,a()(Ue.Z,{href:i,onClick:()=>this.track("mention_edit"),innerStyle:We.editButtonStyle},void 0,a()(Be.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions())}renderCommentActivity(e){if(!e.edits)return;const t=(0,ee.Kv)(this.props.rootStore,{table:J.qF,id:e.discussion_id,spaceId:e.space_id}),o=t.getValue();if(!o)return;const r=Q.Z.createChildStore(this.props.rootStore,{table:O.iU,id:o.parent_id}),i=(0,$.qA)(r),s=(0,$.Zg)(i),n=r.getValue();if(!n)return;const h=this.getBlockValue(e.navigable_block_id);if(!h)return;const d=s?(0,g.Om)({table:"block",value:n,getRecordValue:this.getRecordValue,discussionId:e.discussion_id}):void 0,l=this.getAuthors(e.edits),c=we(l),u=e=>{if(this.track("comment_edit"),!s){const o=e.target;(0,q.oK)({environment:this.environment,discussionStore:t,rect:o.getBoundingClientRect(),blockStore:r})}};return a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} commented in {blockName}} other {{authorOrAuthors} commented in {blockName}}}",values:{numberOfAuthors:l.length,authorOrAuthors:c,blockName:this.renderTitle("block",h)},id:"activity.commentActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.navigable_block_id,"block"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:a()(Te,{authors:l}),showSnapshotButton:!1},void 0,this.renderCommentContext({activity:e,url:d,onClick:u}),a()(Ge,{visible:5,items:e.edits.map(((e,t,o)=>a()(Ue.Z,{onClick:u,href:d,innerStyle:We.editButtonStyle},t,a()(Be.Z,{edit:e,rootStore:this.props.rootStore}))))}),this.renderCommentActions(e,s))}renderCommentContext(e){const{url:t,onClick:o}=e,r=this.getDiscussionContextAndId();if(!r)return;const{id:i,context:s}=r,n=0===(0,P.ll)(s).length,h=(0,W.IY)({environment:this.environment,textValue:{value:s,spaceId:this.props.activity.space_id},parentStore:this.props.rootStore,disableHover:!0,disableStyleAnnotations:!1,disableDateStyleAnnotations:!1,disabled:!0,highlightDiscussionId:i,theme:this.theme,emojiType:(0,H.e)(this.environment),katex:this.environment.KatexStore.getKatex(),enableEndOfLineMarker:!1});return a()(Ue.Z,{href:t,onClick:o,innerStyle:{...We.editButtonStyle,display:"flex",alignItems:"flex-start",fontSize:14,...n&&{color:this.theme.mediumTextColor},paddingTop:2,paddingBottom:6,marginBottom:0}},void 0,n&&a()("div",{style:{flexShrink:0,alignSelf:"center",width:3,borderRadius:3,marginLeft:2,marginRight:8,height:20,background:v.DB}}),a()("div",{style:{...Z.Z.textOverflowStyle}},void 0,h))}renderCommentActions(e,t){const o=this.getRecordValue({table:J.qF,id:e.discussion_id,spaceId:e.space_id});if(!o)return;const r=(0,ee.Kv)(this.props.rootStore,{table:J.qF,id:o.id,spaceId:(0,y.CG)(this.props.rootStore.pointer.spaceId)}),i=Q.Z.createChildStore(this.props.rootStore,{table:O.iU,id:o.parent_id});return a()("div",{style:{paddingLeft:52,paddingTop:12,paddingBottom:4}},void 0,a()(Ve.Z,{onClick:e=>{const t=e.target;(0,q.oK)({environment:this.environment,discussionStore:r,rect:t.getBoundingClientRect(),blockStore:i})},style:this.getActionButtonStyle()},void 0,a()(L.FormattedMessage,{defaultMessage:"Reply",id:"activity.replyButton.label"})),this.canUnarchive()&&a()(d.Fragment,{},void 0,Ke,a()(Ve.Z,{onClick:this.handleUnarchive,style:this.getActionSecondaryButtonStyle()},void 0,a()(L.FormattedMessage,{defaultMessage:"Unarchive",id:"activity.unarchiveButton.label"}))))}renderAccessRequestedActions(e){const{rootStore:t}=this.props;if(!(e.edits||[])[0])return;const o=(0,ee.Kv)(t,{table:A.J8,id:e.access_request_id}),r=o.getValue();if(!r||r.parent_table!==O.iU)return;const i=Q.Z.createChildStore(t,{table:O.iU,id:r.parent_id});return i.canAdmin()?a()("div",{style:We.actionPrimaryContainerStyle},void 0,a()(Le,{accessRequestStore:o,targetBlockStore:i,initialRole:"reader",buttonStyle:this.getActionButtonStyle(),notification:this.props.notification})):void 0}renderNotificationActions(){if(this.canUnarchive())return a()("div",{style:We.actionContainerStyle},void 0,a()(Ve.Z,{onClick:this.handleUnarchive,style:this.getActionSecondaryButtonStyle()},void 0,a()(L.FormattedMessage,{defaultMessage:"Unarchive",id:"activity.actions.unarchiveButton.label"})));const e=this.getFollowStore();if(!e)return;const t=e.getValue();return t?t.following?a()("div",{style:We.actionPrimaryContainerStyle},void 0,a()(Ve.Z,{onClick:this.handleUnfollow,style:this.getActionButtonStyle()},void 0,a()(L.FormattedMessage,{defaultMessage:"Unfollow this page",id:"activity.unfollowPageButton.label"}))):a()("div",{style:We.actionPrimaryContainerStyle},void 0,a()(Ve.Z,{onClick:this.handleFollow,style:this.getActionButtonStyle()},void 0,a()(L.FormattedMessage,{defaultMessage:"Re-follow this page",id:"activity.refollowPageButton.label"}))):void 0}renderUserInvitedActivity(e){if(!e.edits)return;let t,o,r;const i=this.getAuthors(e.edits),s=we(i),n=0===i.filter(p.uC).length,h=parseInt(e.end_time),d=e.edits[0];if(d.navigable_block_id){const l=this.getBlockValue(d.navigable_block_id);if(!l)return;const c=this.renderTitle("block",l),u=(0,N.$e)(l,e);if(u){const t=this.getRecordValue({table:B.Tu,id:u,spaceId:e.space_id});t&&t.message&&t.created_time<=h+5*F.hM&&(r={message:null==t?void 0:t.message,url:(0,g.Om)({table:O.iU,value:l,getRecordValue:this.getRecordValue})})}o=a()(L.FormattedMessage,n?{defaultMessage:"You have been invited to {blockName}",values:{blockName:c},id:"activity.userInvitedActivityNavigableBlockByBot.header"}:{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} invited you to {blockName}} other {{authorOrAuthors} invited you to {blockName}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,blockName:c},id:"activity.userInvitedActivityNavigableBlock.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),t=this.getIsRecordPrivateToUser(l.id,"block")}else if(d.permission_group_id){const e=(0,b.Bg)({spaceId:d.space_id,permissionGroupId:d.permission_group_id,getRecordValue:this.getRecordValue}),r=this.renderPermissionGroupTitle(e,d.space_id);o=a()(L.FormattedMessage,n?{defaultMessage:"You have been added to group {groupName}",values:{groupName:r},id:"activity.userInvitedActivityGroupIdByBot.header"}:{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} added you to group {groupName}} other {{authorOrAuthors} added you to group {groupName}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,groupName:r},id:"activity.userInvitedActivityGroupId.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),t=this.getIsRecordPrivateToUser(d.space_id,"space")}else{const e=this.getSpaceValue(d.space_id);if(!e)return;const r=this.renderTitle("space",e);o=a()(L.FormattedMessage,n?{defaultMessage:"You have been invited to {spaceName}",values:{spaceName:r},id:"activity.userInvitedActivityOtherInviteByBot.header"}:{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} invited you to {spaceName}} other {{authorOrAuthors} invited you to {spaceName}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,spaceName:r},id:"activity.userInvitedActivityOtherInvite.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),t=this.getIsRecordPrivateToUser(d.space_id,"space")}const l=n?void 0:a()(Te,{authors:i});return a()(Je,{timestamp:h,header:a()("span",{},void 0,o),isLast:this.props.isLast,isPrivate:t,rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:l,showSnapshotButton:!1},void 0,r&&a()(Ue.Z,{href:r.url,onClick:()=>this.track("click_user_invited"),innerStyle:this.getInviteMessageStyle()},void 0,r.message))}renderTeamMembershipEditedActivity(e){if(!e.edits)return;const t=this.getAuthors(e.edits),o=we(t),r=e.edits[0],i=this.getTeamValue(r.team_id);if(!i)return;const s=this.renderTeamTitle("team",i),n=a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} invited you to teamspace {teamName}} other {{authorOrAuthors} invited you to {teamName}}}",values:{numberOfAuthors:t.length,authorOrAuthors:o,teamName:s},id:"activity.userInvitedToTeamActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,n),isLast:this.props.isLast,isPrivate:!1,rootStore:this.props.rootStore,notification:this.props.notification,icon:a()(Te,{authors:t}),showSnapshotButton:!1})}renderPrivateContentTransferredActivity(e){if(!e.edits)return;const t=e.edits[0],o=t.from_user_id,r=this.getRecordValue({table:C.KJ,id:o});if(!r)return;const i=t.to_user_id;if(!this.getRecordValue({table:C.KJ,id:i}))return;const s=this.getBlockValue(e.navigable_block_id);if(!s)return;const n=(0,p.$4)(j.default.getIntl(),{table:C.KJ,value:r}),h=this.getAuthors(e.edits),d=we(h),l=a()(L.FormattedMessage,{defaultMessage:"{authorPhrase} transferred private content from {fromUserName} to you: {pageName}",values:{authorPhrase:d,fromUserName:n,pageName:this.renderTitle("block",s)},id:"activity.privateContentTransferred.header",description:"Notification header for when private content is transferred from one user to another."});return a()(Je,{timestamp:parseInt(e.end_time),header:l,isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(s.id,"block"),rootStore:this.props.rootStore,notification:this.props.notification,icon:a()(Te,{authors:h}),showSnapshotButton:!1})}renderCollectionEdited(e){if(!e.edits)return;const t=this.getRecordValue({table:T.v,id:e.collection_id,spaceId:e.space_id});if(!t)return;const o=e.edits[0];if(!o)return;const r=(0,g.Om)({table:T.v,value:t,getRecordValue:this.getRecordValue}),i=this.getAuthors(e.edits),s=we(i),n=this.renderTitle("collection",t),h="collection-created"===o.type?a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created {collectionTitle}} other {{authorOrAuthors} created {collectionTitle}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,collectionTitle:n},id:"activity.collectionCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited {collectionTitle}} other {{authorOrAuthors} edited {collectionTitle}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,collectionTitle:n},id:"activity.collectionEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,h),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.collection_id,"collection"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:a()(Te,{authors:i}),showSnapshotButton:this.props.isTopbarUpdatesMenu},void 0,u.OC(o)&&this.renderCollectionDescriptionEdit(o,r),this.renderNotificationActions())}renderCollectionDescriptionEdit(e,t){return a()(Ue.Z,{href:t,innerStyle:We.editButtonStyle},void 0,a()(Be.Z,{edit:e,rootStore:this.props.rootStore}))}renderCollectionViewEdited(e){if(!e.edits)return;const t=this.getRecordValue({table:T.v,id:e.collection_id,spaceId:e.space_id});if(!t)return;const o=this.getRecordValue({table:k.n,id:e.collection_view_id,spaceId:e.space_id});if(!o)return;const r=(0,R.hI)(e.edits)[0];if(!r)return;const i=this.renderCollectionViewTitle(o),s=this.renderTitle("collection",t),n=this.getAuthors(e.edits),h=we(n);let d;return d="collection-view-created"===r.type?a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created view {collectionViewTitle} in {collectionTitle}} other {{authorOrAuthors} created view {collectionViewTitle} in {collectionTitle}}}",values:{numberOfAuthors:n.length,authorOrAuthors:h,collectionTitle:s,collectionViewTitle:i},id:"activity.collectionViewCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"collection-view-deleted"===r.type?a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted view {collectionViewTitle} in {collectionTitle}} other {{authorOrAuthors} deleted view {collectionViewTitle} in {collectionTitle}}}",values:{numberOfAuthors:n.length,authorOrAuthors:h,collectionTitle:s,collectionViewTitle:i},id:"activity.collectionViewDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited view {collectionViewTitle} in {collectionTitle}} other {{authorOrAuthors} edited view {collectionViewTitle} in {collectionTitle}}}",values:{numberOfAuthors:n.length,authorOrAuthors:h,collectionTitle:s,collectionViewTitle:i},id:"activity.collectionViewEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,d),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.collection_id,"collection"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:a()(Te,{authors:n}),showSnapshotButton:this.props.isTopbarUpdatesMenu},void 0,this.renderNotificationActions())}renderCollectionPropertyEdited(e){if(!e.edits)return;const t=(0,R.hI)(e.edits)[0];if(!t)return;const o=this.getRecordValue({table:T.v,id:e.collection_id,spaceId:e.space_id});if(!o)return;const r="collection-property-changed"===t.type?t.collection_property_data.after:t.collection_property_data,i=this.getAuthors(e.edits),s=we(i),n=this.renderTitle("collection",o),h=this.renderCollectionPropertyTitle(r);let d;return d="collection-property-created"===t.type?a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created property {collectionPropertyTitle} in {collectionTitle}} other {{authorOrAuthors} created property {collectionPropertyTitle} in {collectionTitle}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,collectionTitle:n,collectionPropertyTitle:h},id:"activity.collectionPropertyCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"collection-property-deleted"===t.type?a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted property {collectionPropertyTitle} in {collectionTitle}} other {{authorOrAuthors} deleted property {collectionPropertyTitle} in {collectionTitle}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,collectionTitle:n,collectionPropertyTitle:h},id:"activity.collectionPropertyDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited property {collectionPropertyTitle} in {collectionTitle}} other {{authorOrAuthors} edited property {collectionPropertyTitle} in {collectionTitle}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,collectionTitle:n,collectionPropertyTitle:h},id:"activity.collectionPropertyEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,d),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.collection_id,"collection"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:a()(Te,{authors:i}),showSnapshotButton:this.props.isTopbarUpdatesMenu},void 0,this.renderNotificationActions())}renderReminderActivity(e){if(!e.edits)return;const t=e.edits[0],o=this.getBlockValue(t.navigable_block_id);if(!o)return;const r=this.getBlockValue(e.reminder_block_id);if(!r)return;const i=(0,g.Om)({table:"block",value:r,getRecordValue:this.getRecordValue});return a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"Reminder in {pageTitle}",id:"activity.reminderInActivity.header",values:{pageTitle:this.renderTitle("block",o)}})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(o.id,"block"),rootStore:this.props.rootStore,navigableBlockId:o.id,notification:this.props.notification,icon:a()(ke,{}),showSnapshotButton:!1},void 0,a()(Ue.Z,{href:i,onClick:()=>this.track("reminder_edit"),innerStyle:We.editButtonStyle},void 0,a()(Be.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions())}renderPageLockActivity(e){if(!e.edits)return;const t=e.edits[0],o=this.getBlockValue(t.navigable_block_id);if(!o)return;const r=this.getAuthors(e.edits),i=we(r),s=this.renderTitle("block",o),n="page-locked"===e.type?a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} locked {blockTitle}} other {{authorOrAuthors} locked {blockTitle}}}",values:{numberOfAuthors:r.length,authorOrAuthors:i,blockTitle:s},id:"activity.pageLocked.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} unlocked {blockTitle}} other {{authorOrAuthors} unlocked {blockTitle}}}",values:{numberOfAuthors:r.length,authorOrAuthors:i,blockTitle:s},id:"activity.pageUnlocked.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,n),isPrivate:this.getIsRecordPrivateToUser(o.id,"block"),isLast:this.props.isLast,rootStore:this.props.rootStore,navigableBlockId:o.id,notification:this.props.notification,icon:a()(Te,{authors:r}),showSnapshotButton:!1},void 0,this.renderNotificationActions())}renderEmailEdited(e){if(!e.edits)return;const t=e.edits[0];if(!t)return;const o=this.getAuthors(e.edits),r=we(o);return a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} changed email from {oldEmail} to {newEmail}} other {{authorOrAuthors} changed email from {oldEmail} to {newEmail}}}",values:{numberOfAuthors:o.length,authorOrAuthors:r,oldEmail:t.old_email,newEmail:t.new_email},id:"activity.emailEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:!1,rootStore:this.props.rootStore,notification:this.props.notification,icon:a()(Te,{authors:o}),showSnapshotButton:!1})}renderAccessRequested(e){if(!e.edits)return;const t=e.edits[0];if(!t)return;const o=this.getBlockValue(e.navigable_block_id);if(!o)return;const r=this.getAuthors(e.edits),i=we(r),{message:s}=t;return a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} requested access to {pageName}} other {{authorOrAuthors} requested access to {pageName}}}",values:{numberOfAuthors:r.length,authorOrAuthors:i,pageName:this.renderTitle(O.iU,o)},id:"activity.accessRequested.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:!1,rootStore:this.props.rootStore,notification:this.props.notification,icon:a()(Te,{authors:r}),showSnapshotButton:!1},void 0,s&&a()("div",{style:{paddingLeft:52,paddingRight:16,marginTop:8,marginBottom:8}},void 0,a()(Ze.Z,{isSmall:!0},void 0,a()(L.FormattedMessage,{id:"activity.accessRequested.messageLabel",defaultMessage:"Message from {author}",values:{author:i}})),a()(Ze.Z,{isMultiline:!0,style:{whiteSpace:"pre-wrap"}},void 0,s)),this.renderAccessRequestedActions(e),this.renderNotificationActions())}renderPageDeleteOrRestoreActivity(e){if(!e.edits)return;const t=e.edits[0];if(!t)return;const o=this.getRecordValue({table:O.iU,id:t.navigable_block_id,spaceId:t.space_id});if(!o)return;const r=this.getAuthors(e.edits),i=we(r),s=this.renderTitle(O.iU,o);let n;return"page-deleted"===e.type?n=a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted {blockTitle}} other {{authorOrAuthors} deleted {blockTitle}}}",values:{numberOfAuthors:r.length,authorOrAuthors:i,blockTitle:s},id:"emailActivity.pageDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"page-restored"===e.type?n=a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} restored {blockTitle}} other {{authorOrAuthors} restored {blockTitle}}}",values:{numberOfAuthors:r.length,authorOrAuthors:i,blockTitle:s},id:"emailActivity.pageDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"page-permanently-deleted"===e.type?n=a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} permanently deleted {blockTitle}} other {{authorOrAuthors} permanently deleted {blockTitle}}}",values:{numberOfAuthors:r.length,authorOrAuthors:i,blockTitle:s},id:"emailActivity.pageDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):(0,V.t1)(e),a()(Je,{timestamp:parseInt(e.end_time),header:a()("span",{},void 0,n),isPrivate:this.getIsRecordPrivateToUser(o.id,"block"),isLast:this.props.isLast,rootStore:this.props.rootStore,navigableBlockId:o.id,notification:this.props.notification,icon:a()(Te,{authors:r}),showSnapshotButton:!1},void 0,this.renderNotificationActions())}renderCollectionPropertyTitle(e){return a()("span",{style:{...We.boldStyle,whiteSpace:"nowrap"}},void 0,a()(f.Z,{type:e.type,size:12,style:We.svgIconStyle,theme:this.theme,isDark:!0})," ",e.name)}renderCollectionViewTitle(e){const t=(0,g.WE)({collectionView:e,getRecordValue:this.getRecordValue});return a()(Ue.Z,{href:t,onClick:()=>this.track("click_title"),external:!1,innerStyle:{...We.pageLinkStyle,...We.boldStyle},inline:!0},void 0,this.renderCollectionViewTypeIcon(e.type),"Â ",a()(Me.Z,{collectionViewName:e.name,collectionViewType:e.type}))}renderCollectionViewTypeIcon(e){const t=We.svgIconStyle;return z.aW[e](t)}getStore(e,t){return"collection"===e?X.Z.createChildStore(this.props.rootStore,{table:T.v,id:t}):"space"===e?te.Z.createChildStore(this.props.rootStore,{table:D.bx,id:t}):"team"===e?oe.Z.createChildStore(this.props.rootStore,{table:I.e0,id:t}):"block"===e?Q.Z.createChildStore(this.props.rootStore,{table:O.iU,id:t}):void(0,V.t1)(e)}renderTitle(e,t){const o=this.getStore(e,t.id),r=(0,g.Al)({table:e,value:t,getRecordValue:this.getRecordValue}),i=(0,g.Om)({table:e,value:t,getRecordValue:this.getRecordValue});return a()(Ue.Z,{href:i,onClick:()=>this.track("click_title"),external:!1,innerStyle:We.pageLinkStyle,inline:!0},void 0,r&&l().createElement(l().Fragment,null,a()(xe.Z,{disabled:!0,icon:r,isEmptyPage:!1,size:18,style:We.recordIconStyle}),a()("span",{},void 0," ")),a()(Ee.Z,{store:o,style:this.getActivityTitleStyle(void 0!==r)}))}renderTeamTitle(e,t){const o=oe.Z.createChildStore(this.props.rootStore,{table:I.e0,id:t.id}),r=(0,g.Al)({table:e,value:t,getRecordValue:this.getRecordValue});return a()(Ue.Z,{onClick:e=>{this.track("click_user_invited_to_team"),(0,G.hI)({environment:this.environment,teamStore:o,shouldScroll:!0}),ie.Z.setState({...ie.Z.state,open:!1}),x.go(this.environment)},external:!1,innerStyle:We.pageLinkStyle,inline:!0},void 0,r&&l().createElement(l().Fragment,null,a()(xe.Z,{disabled:!0,icon:r,isEmptyPage:!1,size:18,style:We.recordIconStyle}),a()("span",{},void 0," ")),a()(Ee.Z,{store:o,style:this.getActivityTitleStyle(void 0!==r)}))}renderPermissionGroupTitle(e,t){let o,r;return e?(o=e.icon,r=e.name||a()(L.FormattedMessage,{defaultMessage:"Untitled group",id:"activity.permissionGroupTitles.untitledGroup"})):r=a()(L.FormattedMessage,{defaultMessage:"Deleted group",id:"activity.permissionGroupTitles.deletedGroup"}),a()("span",{},void 0,o&&a()(xe.Z,{disabled:!0,icon:{icon:o,pointer:{table:"space",id:t}},isEmptyPage:!1,size:18,style:We.recordIconStyle}),a()("span",{style:this.getActivityTitleStyle(void 0!==o)},void 0,r))}renderPermissionGroupEditedHeader(e){const{activity:t,authors:o,groupName:r}=e,i=we(o),s=(0,R.hI)(t.edits||[])[0];return s?"permission-group-created"===s.type?a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created group {groupName}} other {{authorOrAuthors} created group {groupName}}}",values:{numberOfAuthors:o.length,authorOrAuthors:i,groupName:a()("span",{style:We.boldStyle},void 0,r)},id:"activity.updatedPermissionGroupCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"permission-group-deleted"===s.type?a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted group {groupName}} other {{authorOrAuthors} deleted group {groupName}}}",values:{numberOfAuthors:o.length,authorOrAuthors:i,groupName:a()("span",{style:We.boldStyle},void 0,r)},id:"activity.updatedPermissionGroupDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited group {groupName}} other {{authorOrAuthors} edited group {groupName}}}",values:{numberOfAuthors:o.length,authorOrAuthors:i,groupName:a()("span",{style:We.boldStyle},void 0,r)},id:"activity.updatedPermissionGroupEditedDefault.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):a()(L.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited group {groupName}} other {{authorOrAuthors} edited group {groupName}}}",values:{numberOfAuthors:o.length,authorOrAuthors:i,groupName:a()("span",{style:We.boldStyle},void 0,r)},id:"activity.updatedPermissionGroupEdit.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})}canUnarchive(){const{notification:e}=this.props;return!!e&&!!e.visited}getFollowStore(){if("following"!==se.Z.state.currentTab)return;const{notification:e}=this.props;if(!e)return;let t=e.navigable_block_id;if(!t){if(!e.collection_id)return;const o=(0,ee.Kv)(this.props.rootStore,{table:T.v,id:e.collection_id,spaceId:e.space_id}).getValue();if(!o)return;t=o.parent_id}const o=this.environment.currentUser.id;if(!o)return;const r=(0,M.$j)({user_id:o,navigable_block_id:t});return(0,ee.Kv)(this.props.rootStore,{table:M.t0,id:r,spaceId:e.space_id})}setFollowing(e){const t=this.getFollowStore();t&&K.createAndCommit({userAction:"Activity.setFollowing",environment:this.environment,perform:o=>{E.sW({store:t,transaction:o,data:{following:e}})}})}get getRecordValue(){return this.props.rootStore.getRecordValue}getBlockStore(e){return Q.Z.createChildStore(this.props.rootStore,{table:O.iU,id:e})}getBlockValue(e){return this.getBlockStore(e).getValue()}getAuthors(e){const t=h().uniqWith(h().flatten(e.map((e=>e.authors||[]))),h().isEqual);return h().compact(t.map(this.getAuthorActor))}track(e){(0,U.W3P)(this.environment,this.props.analyticsContext,{target:e,type:u.Fb(this.props.activity)})}getIsRecordPrivateToUser(e,t){const{source:o}=this.props;if("all_updates"===o){if(!e)return!1;let o;return o="block"===t?Q.Z.createChildStore(this.props.rootStore,{table:O.iU,id:e}):"collection"===t?X.Z.createChildStore(this.props.rootStore,{table:T.v,id:e}):te.Z.createChildStore(this.props.rootStore,{table:D.bx,id:e}),(0,Y.yi)(this.environment,o)}return!1}getActionButtonStyle(){return{boxShadow:this.theme.plainButtonBoxShadow,height:26,paddingLeft:8,paddingRight:8,fontWeight:500,color:this.theme.regularTextColor}}getActionSecondaryButtonStyle(){return{height:26,paddingLeft:8,paddingRight:8,color:this.theme.mediumTextColor}}getInviteMessageStyle(){return{paddingLeft:52,paddingTop:8,paddingBottom:8,paddingRight:12,fontSize:14}}getActivityTitleStyle(e){return{display:"inline",whiteSpace:"normal",marginRight:e?3:0,wordBreak:"break-word",...We.boldStyle}}}i()(We,"actionContainerStyle",{paddingLeft:44,paddingTop:4}),i()(We,"actionPrimaryContainerStyle",{paddingLeft:52,paddingTop:12,paddingBottom:8}),i()(We,"canSelectStyle",{userSelect:"text",WebkitUserSelect:"text"}),i()(We,"boldStyle",{fontWeight:Z.Z.fontWeight.semibold}),i()(We,"pageLinkStyle",{padding:1,...We.canSelectStyle}),i()(We,"recordIconStyle",{display:"inline-flex",marginRight:2,verticalAlign:"text-top"}),i()(We,"svgIconStyle",{width:12,height:12,display:"inline",verticalAlign:"middle",marginBottom:2,marginLeft:2}),i()(We,"editButtonStyle",{padding:0,paddingLeft:52,paddingRight:16,...We.canSelectStyle});const ze=We}}]);