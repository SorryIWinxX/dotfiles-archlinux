"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[653],{45993:(e,t,n)=>{n.r(t),n.d(t,{default:()=>N});var r=n(97464),o=n.n(r),a=n(77094),i=n.n(a),s=n(17126),c=n(67294),p=n.n(c),u=n(54483),d=n(480),l=n(28350),m=n(24405),f=n(53397);const h={day:3,week:2,month:1,year:0};function g(e){const{start_date:t,frequency:n,interval:r,weekdays:o,timezone:a}=e,i=new Date(t),s=i.getUTCFullYear(),c=i.getUTCMonth(),p=i.getUTCDate();return{freq:h[n],dtstart:new Date(Date.UTC(s,c,p)),interval:r,byweekday:o,tzid:a}}var b=n(98963),k=n(97880),v=n(5366),y=n(32918),M=n(4615),I=n(86777),C=n(96802),P=n(9953),S=n(93561);function w(e){let{environment:t,blockStore:n,recurrence:r}=e;const o=n.getAutomationId(),a=Z(r);o?function(e,t,n,r){const o={table:b.c,id:t,spaceId:n.getSpaceId()};(0,S.createAndCommit)({environment:e,userAction:"recurrenceActions.updateRecurrence",perform:e=>{P.sW({store:(0,I.Kv)(n,o),data:{status:"active",recurrence:Z(r)},transaction:e})}})}(t,o,n,a):function(e,t,n){const r=(0,M.ZP)();(0,S.createAndCommit)({environment:e,userAction:"recurrenceActions.createRecurrence",perform:o=>{P.ae({environment:e,table:b.c,inMemoryRecordCache:t.inMemoryRecordCache,value:{id:r,parent_id:t.id,parent_table:t.table,space_id:t.getSpaceId(),status:"active",recurrence:n},transaction:o}),C.FH({stores:[t],update:{automation_id:r},transaction:o})}})}(t,n,a)}function Z(e){return{...e,id:(0,M.ZP)(),start_date:Date.now(),timezone:y.x7}}var T=n(25498),A=n(43860),R=n(48762),F=n(46167),E=n(77422),O=n.n(E),D=(n(33948),n(96486)),x=n.n(D),_=n(83355),q=n(39500),U=n(61766),K=n(19757),V=n(66722);class B extends _.Z{constructor(){super(...arguments),O()(this,"storeTypes",{buttonPopupStore:U.Z}),O()(this,"renderPopup",(()=>this.props.render({close:this.handleClose}))),O()(this,"handleButtonClick",(e=>{const{buttonPopupStore:t}=this.stores;this.props.stopClickPropagation&&(null==e||e.stopPropagation()),e&&q.uG(e)||(this.props.onClick&&this.props.onClick(e),this.props.disablePopup||t.setState({...t.state,open:!0}))})),O()(this,"handleClose",(()=>{this.props.onClose&&this.props.onClose(),this.props.persistOnClose||this.stores.buttonPopupStore.reset()}))}willUnmount(){this.stores.buttonPopupStore.setState({open:!1})}renderComponent(){const{buttonPopupStore:e}=this.stores,t={...this.props,onClick:this.props.disabled?x().identity:this.handleButtonClick};return p().createElement(V.ZP,o()({},this.props,{forceInitialInbound:Boolean(this.props.forceInitialInbound),render:this.renderPopup,open:e.state.open,onDismiss:this.handleClose,origin:this.props.renderOrigin(t),originGap:this.props.originGap,borderRadius:this.props.borderRadius,popupWrapStyle:this.props.popupWrapStyle}))}}O()(B,"Alignment",K.v2),O()(B,"Placement",K.ug),O()(B,"PopupType",V.kQ);const W=B;var z=n(1464),G=n(71202),L=n(86646),H=n(25584),J=n(83071);const N=(0,c.forwardRef)((function(e,t){const n=(0,d.O7)(),{device:r}=n,a=(0,m.F)(),c=e.templateStore,h=(0,l.VK)((()=>{const e=c.getAutomationId(),t=c.getSpaceId();if(e&&t)return A.Z.createChildStore(c,{id:e,spaceId:t,table:b.c})}),[c]),k=(0,l.VK)((()=>void 0===c.getAutomationId()||(null==h?void 0:h.isReady())),[c,h]),y=(0,l.VK)((()=>{var e;return null!==(e=null==h?void 0:h.isActive())&&void 0!==e&&e}),[h]),M=(0,l.VK)((()=>null==h?void 0:h.getRecurrenceConfigStore().getValue()),[h]);return p().createElement(W,o()({},e,{popupType:r.isMobile?F.Z.PopupType.SlideUp:F.Z.PopupType.Popup,ref:t,renderOrigin:t=>p().createElement(z.Z,o()({},t,{icon:f.Z.repeat({width:14}),title:i()(v.FormattedMessage,{defaultMessage:"Repeat",id:"database.templatePickerItem.actionMenu.repeat"}),focused:e.focused,showExtensionArrow:r.isMobile,right:k&&j({isActive:y,recurrence:M})})),render:t=>p().createElement(G.Z,function(e,t){return t?{menuType:G.Z.MenuType.Modal,title:i()(v.FormattedMessage,{defaultMessage:"Repeat",id:"database.templatePickerItem.mobileRepeatModal.title"}),right:i()(v.FormattedMessage,{defaultMessage:"Done",id:"ddatabase.templatePickerItem.mobileDoneRepeatButton.label"}),onClickRight:e.close}:{menuType:G.Z.MenuType.Popup,width:250}}(t,r.isMobile),i()(H.Z,{type:H.Z.Type.Vertical,sections:[{key:"repeatOptionsSection",render:e=>p().createElement(J.Z,e),items:Y(n,t,e.templateStore)}],initialFocus:void 0}),y&&M&&function(e,t){const n=new u.ZP(g(e)).after(new Date),r=s.ou.fromJSDate(n).toUTC().toLocaleString(s.ou.DATETIME_SHORT);return i()(J.Z,{topBorder:!0},void 0,i()(L.Z,{caption:i()("span",{style:{color:t.lightTextColor}},void 0,i()(v.FormattedMessage,{defaultMessage:"Next at: {dates}",id:"database.templatePickerItem.recurrenceConfigMenuLabel.next",description:"When repeat will happen next.",values:{dates:r}}))}))}(M,a))}))}));function Q(e){switch(e){case"day":return i()(v.FormattedMessage,{defaultMessage:"Every day",id:"database.templatePickerItem.quickOptionMenuItem.day"});case"week":return i()(v.FormattedMessage,{defaultMessage:"Every week",id:"database.templatePickerItem.quickOptionMenuItem.week"});case"month":return i()(v.FormattedMessage,{defaultMessage:"Every month",id:"database.templatePickerItem.quickOptionMenuItem.month"});case"year":return i()(v.FormattedMessage,{defaultMessage:"Every year",id:"database.templatePickerItem.quickOptionMenuItem.year"});default:(0,k.t1)(e)}}function Y(e,t,n){const r=T.m.map((r=>({key:r.frequency,action:()=>{w({environment:e,recurrence:r,blockStore:n}),t.close()},render:e=>p().createElement(R.Z,o()({},e,{title:Q(r.frequency)}))})));return r.push({key:"disable",action:()=>{!function(e){let{environment:t,blockStore:n}=e;const r=n.getAutomationId();if(!r)return;const o={table:b.c,id:r,spaceId:n.getSpaceId()};(0,S.createAndCommit)({environment:t,userAction:"recurrenceActions.disableRecurrence",perform:e=>{P.sW({store:(0,I.Kv)(n,o),data:{status:"disabled",run_at:void 0},transaction:e})}})}({environment:e,blockStore:n}),t.close()},render:e=>p().createElement(R.Z,o()({},e,{title:i()(v.FormattedMessage,{defaultMessage:"Off",id:"database.templatePickerItem.quickOptionMenuItem.off",description:"Turn off automatically repeating a task."})}))}),r}function j(e){let{isActive:t,recurrence:n}=e;if(!t)return i()(v.FormattedMessage,{defaultMessage:"Off",id:"database.templatePickerItem.recurrenceConfigMenuLabel.off",description:"Indicate there is no repeat configured."});if(n){const e=new u.ZP(g(n));return i()(c.Fragment,{},void 0,e.toText())}}}}]);